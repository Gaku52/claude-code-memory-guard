name: Lint

on:
  push:
    branches: [main]
  pull_request:
    branches: [main]

jobs:
  shellcheck:
    name: ShellCheck
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4

      - name: Run ShellCheck on shell scripts
        uses: ludeeus/action-shellcheck@master
        with:
          scandir: '.'
          additional_files: 'memory-guard.sh install.sh uninstall.sh'

  json-validate:
    name: JSON Validation
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4

      - name: Validate JSON files
        run: |
          echo "Validating hooks-config.json..."
          python3 -m json.tool hooks-config.json > /dev/null
          echo "âœ“ hooks-config.json is valid"

  test-install:
    name: Installation Test
    runs-on: macos-latest
    steps:
      - uses: actions/checkout@v4

      - name: Install jq
        run: brew install jq

      - name: Run installer
        run: bash install.sh

      - name: Verify installation
        run: |
          test -x ~/.claude/memory-guard.sh
          test -f ~/.claude/memory-guard-config.env
          test -f ~/.claude/settings.json
          grep -q "memory-guard" ~/.claude/settings.json
          echo "All installation checks passed"

      - name: Test memory-guard.sh runs without error
        run: bash ~/.claude/memory-guard.sh

      - name: Run uninstaller
        run: bash uninstall.sh

      - name: Verify uninstallation
        run: |
          test ! -f ~/.claude/memory-guard.sh
          test ! -f ~/.claude/memory-guard-config.env
          echo "All uninstallation checks passed"
