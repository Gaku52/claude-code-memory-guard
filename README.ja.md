# Claude Code Memory Guard

[![License: MIT](https://img.shields.io/badge/License-MIT-yellow.svg)](https://opensource.org/licenses/MIT)
[![macOS](https://img.shields.io/badge/platform-macOS-blue.svg)](https://www.apple.com/macos/)

Claude Codeã®ãƒ¡ãƒ¢ãƒªæ¯æ¸‡å•é¡Œã‚’è§£æ±ºã™ã‚‹è‡ªå‹•ç›£è¦–ãƒ„ãƒ¼ãƒ«

[English](README.md) | æ—¥æœ¬èª

## æ¦‚è¦

Claude Code Memory Guardã¯ã€Claude Codeã®æœ€å¤§ã®èª²é¡Œã§ã‚ã‚‹**ãƒ¡ãƒ¢ãƒªæ¯æ¸‡å•é¡Œ**ã‚’è‡ªå‹•çš„ã«æ¤œå‡ºã—ã€é©åˆ‡ãªå¯¾å¿œã‚’ä¿ƒã™ãƒ„ãƒ¼ãƒ«ã§ã™ã€‚

### ä¸»ãªæ©Ÿèƒ½

- **è‡ªå‹•ãƒ¡ãƒ¢ãƒªç›£è¦–**: ãƒ„ãƒ¼ãƒ«å®Ÿè¡Œå¾Œã«è‡ªå‹•çš„ã«ãƒ¡ãƒ¢ãƒªçŠ¶æ…‹ã‚’ãƒã‚§ãƒƒã‚¯
- **æ®µéšçš„ã‚¢ãƒ©ãƒ¼ãƒˆ**: WARNINGï¼ˆè­¦å‘Šï¼‰ã¨CRITICALï¼ˆç·Šæ€¥ï¼‰ã®2æ®µéšé€šçŸ¥
- **ãƒ—ãƒ­ã‚¢ã‚¯ãƒ†ã‚£ãƒ–ãªå¯¾å¿œ**: ãƒ¡ãƒ¢ãƒªä¸è¶³ã«ãªã‚‹å‰ã«æœ€é©åŒ–ã‚’ä¿ƒã™
- **ã‚«ã‚¹ã‚¿ãƒã‚¤ã‚ºå¯èƒ½**: ã—ãã„å€¤ã‚„ç›£è¦–é–“éš”ã‚’è‡ªç”±ã«è¨­å®š

### è§£æ±ºã™ã‚‹èª²é¡Œ

Claude Codeã§ã®é•·æ™‚é–“ã‚»ãƒƒã‚·ãƒ§ãƒ³ã§ã‚ˆãã‚ã‚‹å•é¡Œï¼š
- çªç„¶ã®å¿œç­”åœæ­¢
- ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆã‚¦ã‚£ãƒ³ãƒ‰ã‚¦ã®æ¯æ¸‡
- å¤§é‡ã®ãƒ•ã‚¡ã‚¤ãƒ«èª­ã¿è¾¼ã¿ã«ã‚ˆã‚‹ãƒ¡ãƒ¢ãƒªåœ§è¿«
- ã‚»ãƒƒã‚·ãƒ§ãƒ³ã®å¼·åˆ¶çµ‚äº†

## ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«

### å‰ææ¡ä»¶

- macOSï¼ˆç¾åœ¨ã¯macOSã®ã¿ã‚µãƒãƒ¼ãƒˆï¼‰
- [Claude Code](https://claude.com/claude-code)ãŒã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«æ¸ˆã¿
- Bash 3.2ä»¥ä¸Š

### ã‚¯ã‚¤ãƒƒã‚¯ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«

```bash
git clone https://github.com/Gaku52/claude-code-memory-guard.git
cd claude-code-memory-guard
bash install.sh
```

ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«å¾Œã€Claude Codeã‚’å†èµ·å‹•ã—ã¦ãã ã•ã„ã€‚

## ä½¿ã„æ–¹

### åŸºæœ¬çš„ãªä½¿ç”¨æ–¹æ³•

ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«å¾Œã€ç‰¹åˆ¥ãªæ“ä½œã¯ä¸è¦ã§ã™ã€‚ãƒ„ãƒ¼ãƒ«ã‚’ä½¿ç”¨ã™ã‚‹ãŸã³ã«è‡ªå‹•çš„ã«ãƒ¡ãƒ¢ãƒªçŠ¶æ…‹ãŒãƒã‚§ãƒƒã‚¯ã•ã‚Œã¾ã™ã€‚

### ãƒ¡ãƒ¢ãƒªçŠ¶æ…‹ã®ç¢ºèª

```
/memorystatus
```

ã“ã®ã‚³ãƒãƒ³ãƒ‰ã§ç¾åœ¨ã®ãƒ¡ãƒ¢ãƒªä½¿ç”¨çŠ¶æ³ã‚’ç¢ºèªã§ãã¾ã™ï¼š

```
# ãƒ¡ãƒ¢ãƒªçŠ¶æ…‹ãƒ¬ãƒãƒ¼ãƒˆ

## ç¾åœ¨ã®ä½¿ç”¨çŠ¶æ³
- ç¾åœ¨ã®ãƒˆãƒ¼ã‚¯ãƒ³ä½¿ç”¨é‡: ç´„ 5,700 ãƒˆãƒ¼ã‚¯ãƒ³
- åˆ©ç”¨å¯èƒ½ãªæœ€å¤§ãƒˆãƒ¼ã‚¯ãƒ³: 200,000 ãƒˆãƒ¼ã‚¯ãƒ³
- ä½¿ç”¨ç‡: ç´„ 2.9%

## ãƒ¡ãƒ¢ãƒªçŠ¶æ…‹
âœ… æ­£å¸¸ - ååˆ†ãªå®¹é‡ãŒåˆ©ç”¨å¯èƒ½ã§ã™
```

### ã‚¢ãƒ©ãƒ¼ãƒˆã¸ã®å¯¾å¿œ

#### âš ï¸ MEMORY WARNINGï¼ˆè­¦å‘Šï¼‰ãŒè¡¨ç¤ºã•ã‚ŒãŸå ´åˆ

1. `/compact` ã‚’å®Ÿè¡Œã—ã¦ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆã‚’å‰Šæ¸›
2. `Read`ãƒ„ãƒ¼ãƒ«ã§`offset`ã¨`limit`ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã‚’ä½¿ç”¨
3. è¤‡é›‘ãªã‚¿ã‚¹ã‚¯ã¯`Task`ã‚µãƒ–ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã«å§”è­²
4. 500è¡Œä»¥ä¸Šã®ãƒ•ã‚¡ã‚¤ãƒ«ã¯éƒ¨åˆ†èª­ã¿è¾¼ã¿

#### ğŸš¨ MEMORY CRITICALï¼ˆç·Šæ€¥ï¼‰ãŒè¡¨ç¤ºã•ã‚ŒãŸå ´åˆ

1. **å³åº§ã«** `/compact` ã‚’å®Ÿè¡Œ
2. ãƒ•ã‚¡ã‚¤ãƒ«èª­ã¿è¾¼ã¿ã‚’åœæ­¢ï¼ˆ`Grep`ã¨`Glob`ã®ã¿ä½¿ç”¨ï¼‰
3. æœ€å°é™ã®ãƒ„ãƒ¼ãƒ«å‘¼ã³å‡ºã—ã«åˆ¶é™
4. ç¾åœ¨ã®ã‚¿ã‚¹ã‚¯ã‚’é€Ÿã‚„ã‹ã«å®Œäº†
5. ã‚»ãƒƒã‚·ãƒ§ãƒ³ã‚’å†èµ·å‹•ã™ã‚‹ã“ã¨ã‚’æ¨å¥¨

## è¨­å®š

è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«: `~/.claude/memory-guard-config.env`

```bash
# ãƒ¡ãƒ¢ãƒªç›£è¦–ã®æœ‰åŠ¹/ç„¡åŠ¹
MEMORY_GUARD_ENABLED=true

# ãƒ¡ãƒ¢ãƒªã—ãã„å€¤ï¼ˆMBï¼‰
WARNING_THRESHOLD_MB=4096    # è­¦å‘Šãƒ¬ãƒ™ãƒ«ï¼ˆãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ: 4GBï¼‰
CRITICAL_THRESHOLD_MB=8192   # ç·Šæ€¥ãƒ¬ãƒ™ãƒ«ï¼ˆãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ: 8GBï¼‰

# ãƒã‚§ãƒƒã‚¯é–“éš”ï¼ˆNå›ã®ãƒ„ãƒ¼ãƒ«ä½¿ç”¨ã”ã¨ã«ãƒã‚§ãƒƒã‚¯ï¼‰
CHECK_INTERVAL=5

# ãƒ­ã‚°ãƒ•ã‚¡ã‚¤ãƒ«ã®æœ€å¤§ã‚µã‚¤ã‚ºï¼ˆãƒã‚¤ãƒˆï¼‰
MAX_LOG_SIZE=1048576
```

è¨­å®šã‚’å¤‰æ›´ã—ãŸå¾Œã€Claude Codeã‚’å†èµ·å‹•ã™ã‚‹å¿…è¦ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚æ¬¡å›ã®ãƒã‚§ãƒƒã‚¯æ™‚ã‹ã‚‰è‡ªå‹•çš„ã«åæ˜ ã•ã‚Œã¾ã™ã€‚

## ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°

### ãƒ¡ãƒ¢ãƒªç›£è¦–ãŒå‹•ä½œã—ãªã„

1. `~/.claude/settings.json` ã«PostToolUseãƒ•ãƒƒã‚¯ãŒè¨­å®šã•ã‚Œã¦ã„ã‚‹ã‹ç¢ºèª
2. `~/.claude/memory-guard.sh` ãŒå®Ÿè¡Œå¯èƒ½ã‹ç¢ºèª: `chmod +x ~/.claude/memory-guard.sh`
3. ãƒ­ã‚°ã‚’ç¢ºèª: `tail -f ~/.claude/memory-guard.log`

### ã‚¢ãƒ©ãƒ¼ãƒˆãŒé »ç¹ã«è¡¨ç¤ºã•ã‚Œã‚‹

- `CHECK_INTERVAL` ã‚’å¢—ã‚„ã™ï¼ˆä¾‹: 10ï¼‰
- ã—ãã„å€¤ã‚’èª¿æ•´ã™ã‚‹ï¼ˆ`WARNING_THRESHOLD_MB`ã‚’å¢—ã‚„ã™ï¼‰

### ä¸€æ™‚çš„ã«ç„¡åŠ¹åŒ–ã—ãŸã„

```bash
echo "MEMORY_GUARD_ENABLED=false" > ~/.claude/memory-guard-config.env
```

## ãƒ•ã‚¡ã‚¤ãƒ«æ§‹æˆ

```
~/.claude/
â”œâ”€â”€ memory-guard.sh              # ãƒ¡ãƒ¢ãƒªç›£è¦–ã‚¹ã‚¯ãƒªãƒ—ãƒˆ
â”œâ”€â”€ memory-guard-config.env      # è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«
â”œâ”€â”€ memory-guard.log             # ãƒ­ã‚°ãƒ•ã‚¡ã‚¤ãƒ«
â”œâ”€â”€ memory-guard-counter         # ãƒã‚§ãƒƒã‚¯é–“éš”ã‚«ã‚¦ãƒ³ã‚¿ãƒ¼
â”œâ”€â”€ commands/
â”‚   â””â”€â”€ memorystatus.md         # /memorystatusã‚³ãƒãƒ³ãƒ‰
â””â”€â”€ settings.json               # Claude Codeè¨­å®šï¼ˆãƒ•ãƒƒã‚¯è¨­å®šå«ã‚€ï¼‰

~/CLAUDE.md                      # ä½¿ç”¨æ–¹æ³•ã‚¬ã‚¤ãƒ‰
```

## ãƒ©ã‚¤ã‚»ãƒ³ã‚¹

MIT License - è©³ç´°ã¯ [LICENSE](LICENSE) ã‚’å‚ç…§

## è²¢çŒ®

ãƒ—ãƒ«ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’æ­“è¿ã—ã¾ã™ï¼å¤§ããªå¤‰æ›´ã‚’è¡Œã†å ´åˆã¯ã€ã¾ãšIssueã‚’é–‹ã„ã¦å¤‰æ›´å†…å®¹ã‚’è­°è«–ã—ã¦ãã ã•ã„ã€‚

## ã‚µãƒãƒ¼ãƒˆ

- Issue: [GitHub Issues](https://github.com/Gaku52/claude-code-memory-guard/issues)
- ä½œè€…: [@Gaku52](https://github.com/Gaku52)

## è¬è¾

Claude Codeã‚³ãƒŸãƒ¥ãƒ‹ãƒ†ã‚£ã®çš†æ§˜ã«æ„Ÿè¬ã—ã¾ã™ã€‚
